
<div  id="alert-message" class="alert alert-{{typeAlert}}" transition="success" v-if="success">
	<button type="button" class="close" data-dismiss="alert">x</button>
	<i class="fa fa-thumbs-o-up text-center">&nbsp;&nbsp; {{msgSucess}}</i>
</div>


<!-- <pre>
	{{$data.errors | json}}
</pre> -->

<div class="row">
	<div class="col-md-12">
		<div class="form-inline pull-right">
			<div class="input-group">
				<select data-toggle="tooltip" title="A mostrar linhas na tabela" class="form-control" name="" v-model="showRow" @change="fetchMarket(1, showRow)">
					<option class="" value="05">05</option>
					<option class="" value="10" selected>10</option>
					<option class="" value="20">20</option>
					<option class="" value="50">50</option>
					<option class="" value="100">100</option>
					<option class="" value="200">200</option>
				</select>
			</div>
			&nbsp;&nbsp;
			<div class="input-group">
				<select data-toggle="tooltip" title="Escolhe as colunas a serem filtrados" class="form-control" name="" v-model="columnsFiltered" multiple="multiple" v-el:colmarket>
					<option class="" value="name"="">Nome</option>
					<option class="" value="location">Localização</option>
				</select>
			</div>
			&nbsp;&nbsp;
			<div v-if="columnsFiltered.length != 0" class="input-group">
				<span class="input-group-addon" id="basic-addon1"><i class="fa fa-search" aria-hidden="true"></i></span>
				<input data-toggle="tooltip" title="Escreva o valor a ser procurado na Tabela"
				v-model="filter.term"
				@keyup="doFilter"
				type="text"
				class="form-control"
				placeholder="Filtrar dados da tabela"
				aria-describedby="basic-addon1">
			</div>

			<div v-else class="input-group">
				<span class="input-group-addon" id="basic-addon1"><i class="fa fa-search" aria-hidden="true"></i></span>
				<input :disabled="columnsFiltered.length == 0" data-toggle="tooltip" title="Para ativar introduza um valor na Coluna"
				type="text"
				class="form-control"
				placeholder="Filtrar dados da tabela"
				aria-describedby="basic-addon1">
			</div>
		</div>
	</div>
</div>
<hr>
<div class="col-md-12">
	<button class="btn btn-primary btn-flat btn-outline pull-left" name="button" data-toggle="modal" data-target="#modal-create-market"><i class="fa fa-plus"></i> Novo</button>
</div>
<br><br>

<div class="col-md-12">
	<div class='table-responsive'>
		<table class='table table-striped table-hover table-success'>
			<thead>
				<tr>
					<th>
						<i :class = "{'fa-sort-amount-asc': sortColumn == 'name' && sortInverse == 1, 'fa-sort-amount-desc':sortColumn == 'name' && sortInverse ==-1}" class="fa fa-sort" aria-hidden="true"></i>
						<a href="#" @click = "doSort($event, 'name')">Nome</a>
					</th>

					<th>
						<i :class = "{'fa-sort-amount-asc': sortColumn == 'location' && sortInverse == 1, 'fa-sort-amount-desc':sortColumn == 'location' && sortInverse ==-1}" class="fa fa-sort" aria-hidden="true"></i>
						<a href="#" @click = "doSort($event, 'location')">Localização</a>
					</th>

					<!-- <th>
					<i :class = "{'fa-sort-amount-asc': sortColumn == 'description' && sortInverse == 1, 'fa-sort-amount-desc':sortColumn == 'description' && sortInverse ==-1}" class="fa fa-sort" aria-hidden="true"></i>
					<a href="#" @click = "doSort($event, 'description')">Descrição</a>
				</th> -->

				<th  class="text-center" colspan="2"><span><i class="fa fa-cogs"></i></span></th>
			</tr>
		</thead>
		<tbody>
			<tr v-for="market in markets | filterBy filter.term | orderBy sortColumn sortInverse">
				<td><a href="#" data-toggle="modal" data-target="#show-market" @click="getThisMarket(market.id)">{{ market.name }}</a></td>
				<td>{{ market.location }}</td>
				<!-- <td>{{ market.description }}</td> -->
				<td align=left>  <a data-toggle="modal" data-target="#modal-edit-market" href="#"> <i class="fa fa-pencil text-primary" @click="getThisMarket(market.id)" > </i></a></td>
				<td align=right><a data-toggle="modal" data-target="#modal-delete-market" href="#"><i class="fa fa-trash text-danger" @click="getThisMarket(market.id)"></i></a></td>
			</tr>
		</tbody>
	</table>
	<div class="row">
		<div class="col-md-6 pull-left">
			<Pagination :source.sync = "pagination" @navigate="navigate"></Pagination>
		</div>
		<div class="col-md-6 pull-right">
			<h6 class="text-right text-help"> Mostrar de <span class="badge">{{pagination.from}}</span>  a <span class="badge">{{pagination.to}}</span>  no total de <span class="badge">{{pagination.total}}</span></h6>
		</div>
	</div>
</div>

<!--------------------------------------------------------------------------------------------------------->

<div id="show-market" class="modal fade" role="dialog">
	<div class="modal-dialog">

		<!-- Modal content-->
		<div class="modal-content">
			<div class="modal-header">
				<button @click="clearField" type="button" class="close" data-dismiss="modal">&times;</button>
				<h4 class="modal-title">Detalhes do {{ newMarket.name }}</h4>
			</div>
			<div class="modal-body">
				<div class="row">
					<div class="col-md-12">
						<div class='table-responsive'>
							<table class='table table-striped table-hover'>
								<thead>
									<tr>
										<th class="text-center" colspan="2">INFORMAÇOES DO MERCADO</th>
									</tr>
								</thead>
								<tbody>
									<tr>
										<td><b>ID</b></td>
										<td><i>{{ newMarket.id }}</i></td>
									</tr>
									<tr>
										<td><b>Nome</b></td>
										<td><i>{{ newMarket.name }}</i></td>
									</tr>
									<tr>
										<td><b>Localização</b></td>
										<td><span class="label label-info"><i>{{ newMarket.location }}</i></span></td>
									</tr>

									<tr>
										<td><b>Descrição</b></td>
										<td><i>{{ newMarket.description }}</i></td>
									</tr>
									<tr>
										<td><b>Data da criação</b></td>
										<td><i>{{ market.created_at | formatDate 'DD/MM/YYYY' }}</i></td>
									</tr>
									<tr>
										<td><b>Data de atualização</b></td>
										<td><i>{{ market.updated_at | formatDate 'DD/MM/YYYY' }}</i></td>
									</tr>

								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>
			<div class="modal-footer">
				<button @click="clearField" type="button" class="btn btn-primary" data-dismiss="modal"><i class="fa fa-check"></i></button>
			</div>
		</div>

	</div>
</div>

<!--------------------------------------------------------------------------------------------------------->

<div class="modal fade" id="modal-delete-market" tabindex="-1" role="dialog" aria-labelledby="" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button @click="clearField" type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
				<h4 class="modal-title" id="">Eliminar</h4>
			</div>
			<div class="modal-body">
				<h5>Eliminar - <span class="text-uppercase">{{newMarket.name}}</span></h5>
			</div>
			<div class="modal-footer">
				<button @click="clearField" type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
				<button  @keyup.enter="deleteMarket(newMarket.id)" @click="deleteMarket(newMarket.id)" type="button" class="btn btn-danger">Eliminar Mercado</button>
			</div>
		</div>
	</div>
</div>


<!--------------------------------------------------------------------------------------------------------->
<!-- Modal -->
<div id="modal-create-market" class="modal fade" role="dialog">
	<div class="modal-dialog">

		<!-- Modal content-->
		<div class="modal-content">
			<div class="modal-header">
				<button @click="clearField" type="button" class="close" data-dismiss="modal">&times;</button>
				<h4 class="modal-title">Registar Mercado</h4>
			</div>
			<div class="modal-body">
				<validator name="validationmarket">
					<form action="#" methods="POST">
						<div class="row">
							<div class="col-md-12">
								<div class="col-md-12">
									<div class="form-group has-feedback">
										<input type="text" class="form-control" name="name" placeholder="Nome do Mercado" v-model="newMarket.name" v-validate:name="['required']"/>
										<span class="fa fa-university form-control-feedback"></span>
										<p style="color:red;" v-if="$validationmarket.name.required && $validationmarket.name.touched"><span data-toggle="tooltip" title="Este campo tem de ser preenchida!">*</span></p>
									</div>
								</div>
							</div>
						</div>

						<div class="row">
							<div class="col-md-12">
								<div class="col-md-12">
									<div class="form-group has-feedback">
										<input type="text" class="form-control" name="location" placeholder="Localização" v-model="newMarket.location" v-validate:location="['required']"/>
										<span class="fa fa-thumb-tack form-control-feedback"></span>
										<p style="color:red;" v-if="$validationmarket.location.required && $validationmarket.location.touched"><span data-toggle="tooltip" title="Este campo tem de ser preenchida!">*</span></p>
									</div>
								</div>
							</div>
						</div>


						<hr><!---------------------------------------------------------------------------------------------------------------->

						<div class="row">
							<div class="col-md-12">
								<div class="col-md-12">
									<div class="form-group has-feedback">
										<textarea name="description" placeholder="Descrição do Mercado" class="form-control" rows="5" cols="40" id="description" v-model="newMarket.description"></textarea>
									</div>
								</div>
							</div>
						</div>
					</form>
				</validator>
			</div>

			<div class="modal-footer">
				<div class="col-md-12">
					<div class="col-md-12">
						<button type="button" class="btn btn-outline-secondary" data-dismiss="modal"><i class="fa fa-times"></i>&nbsp; &nbsp;&nbsp; Cancelar</button>

						<button :disabled = "!$validationmarket.valid" @click="createMarket" class="btn btn-primary pull-right" type="submit"><i class="fa fa-save"></i>&nbsp; &nbsp;&nbsp;Guardar</button>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<!--------------------------------------------------------------------------------------------------------->

<!-- Modal -->
<div id="modal-edit-market" class="modal fade" role="dialog">
	<div class="modal-dialog">
		<!-- Modal content-->
		<div class="modal-content">
			<div class="modal-header">
				<button @click="clearField" type="button" class="close" data-dismiss="modal">&times;</button>
				<h4 class="modal-title">Editar Mercado</h4>
			</div>
			<div class="modal-body">
				<validator name="validation1">
					<form methods="patch">
						<div class="row">
							<div class="col-md-12">
								<div class="col-md-12">
									<div class="form-group has-feedback">
										<input type="text" class="form-control" name="name" v-model="newMarket.name" v-validate:name="['required']"/>
										<span class="fa fa-university form-control-feedback"></span>
										<p style="color:red;" v-if="$validation1.name.required && $validation1.name.touched"><span data-toggle="tooltip" title="Este campo tem de ser preenchida!">*</span></p>
									</div>
								</div>
							</div>
						</div>

						<div class="row">
							<div class="col-md-12">
								<div class="col-md-12">
									<div class="form-group has-feedback">
										<input type="text" class="form-control" name="location" v-model="newMarket.location" v-validate:location="['required']"/>
										<span class="fa fa-thumb-tack form-control-feedback"></span>
										<p style="color:red;" v-if="$validation1.location.required && $validation1.location.touched"><span data-toggle="tooltip" title="Este campo tem de ser preenchida!">*</span></p>
									</div>
								</div>
							</div>
						</div>


						<hr><!---------------------------------------------------------------------------------------------------------------->

						<div class="row">
							<div class="col-md-12">
								<div class="col-md-12">
									<div class="form-group has-feedback">
										<textarea name="description" placeholder="Descrição do Mescado" class="form-control" rows="5" cols="40" id="description" v-model="newMarket.description"></textarea>
									</div>
								</div>
							</div>
						</div>
					</form>
				</validator>
			</div>
			<div class="modal-footer">
				<button @click="clearField" type="button" class="btn btn-secondary" data-dismiss="modal"><i class="fa fa-times"></i>&nbsp; &nbsp;&nbsp; Cancelar</button>
				<button v-on:show="" @click="saveEditedMarket(newMarket.id)" type="button" class="btn btn-primary"><i class="fa fa-refresh fa-spin"></i>&nbsp; &nbsp;&nbsp; Atualizar</button>
			</div>
		</div>
	</div>
</div>
</div>
