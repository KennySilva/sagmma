<div class="alert alert-success" transition="success" v-if="success">
	<i class="fa fa-thumbs-up"> Sucesso!!</i>
</div>

<div class="row">
	<div class="pull right col-md-8">
		<label class="checkbox-inline"><input type="checkbox" id="" value="" v-model="showColumn.begnning_date">Início</label>
		<label class="checkbox-inline"><input type="checkbox" id="" value="" v-model="showColumn.ending_date">Término</label>
		<label class="checkbox-inline"><input type="checkbox" id="" value="" v-model="showColumn.trader_id">Comerciante</label>
	</div>

	<div class="col-md-4 pull-left">
		<div class="input-group">
			<span class="input-group-addon" id="basic-addon1"><i class="fa fa-search" aria-hidden="true"></i></span>
			<input v-model="filter.term" type="text" class="form-control" placeholder="Filtrar..." aria-describedby="basic-addon1">
		</div>
	</div>
</div>

<hr>

<div class="row">
	<div v-if = "traders.length > 0 && products.length > 0" class="col-md-12">
		<button @click="clearField" class="btn btn-primary btn-flat btn-outline pull-left" name="button" data-toggle="modal" data-target="#modal-create-promotion"><i class="fa fa-plus"></i> Novo</button>&nbsp;&nbsp;
	</div>

	<div v-else class="col-md-12">
		<button data-toggle="tooltip" title="Não podes criar promoção referenciar comerciante e produtos" type="button" class="btn btn-danger btn-flat"><i class="fa fa-minus"></i> Novo</button>&nbsp;&nbsp;
	</div>

</div>

<br>

<div class="row">
	<div class="col-md-12">
		<div class='table-responsive'>
			<table class='table table-striped table-hover table-condensed'>
				<thead>
					<tr>
						<th>
							<i :class = "{'fa-sort-amount-asc': sortColumn == 'name' && sortInverse == 1, 'fa-sort-amount-desc':sortColumn == 'name' && sortInverse ==-1}" class="fa fa-sort" aria-hidden="true"></i>
							<a href="#" @click = "doSort($event, 'name')">Nome</a>
						</th>
						<th class="info" v-if="showColumn.begnning_date">
							<i :class = "{'fa-sort-amount-asc': sortColumn == 'begnning_date' && sortInverse == 1, 'fa-sort-amount-desc':sortColumn == 'begnning_date' && sortInverse ==-1}" class="fa fa-sort" aria-hidden="true"></i>
							<a href="#" @click = "doSort($event, 'begnning_date')">Início</a>
						</th>
						<th class="info" v-if="showColumn.ending_date">
							<i :class = "{'fa-sort-amount-asc': sortColumn == 'ending_date' && sortInverse == 1, 'fa-sort-amount-desc':sortColumn == 'ending_date' &&   sortInverse ==-1}" class="fa fa-sort" aria-hidden="true"></i>
							<a href="#" @click = "doSort($event, 'ending_date')">Término</a>
						</th>

						<th   class="text-center">
							<i :class = "{'fa-sort-amount-asc': sortColumn == 'state' && sortInverse == 1, 'fa-sort-amount-desc':sortColumn == 'state' &&   sortInverse ==-1}" class="fa fa-sort" aria-hidden="true"></i>
							<a href="#" @click = "doSort($event, 'state')">Publicação</a>
						</th>


						<th class="info" v-if="showColumn.trader_id">
							<i :class = "{'fa-sort-amount-asc': sortColumn == 'trader_id' && sortInverse == 1, 'fa-sort-amount-desc':sortColumn == 'trader_id' &&   sortInverse ==-1}" class="fa fa-sort" aria-hidden="true"></i>
							<a href="#" @click = "doSort($event, 'trader_id')">Comerciante</a>
						</th>


						<th  class="text-center" colspan="2"><span><i class="fa fa-cogs"></i></span></th>
					</tr>
				</thead>
				<tbody>
					<tr v-for="promotion in promotions | filterBy filter.term | orderBy sortColumn sortInverse">
						<td><a href="#" data-toggle="modal" data-target="#show-promotion" @click="getThisPromotion(promotion.id)">{{ promotion.name }}</a></td>
						<td class="info" v-if="showColumn.begnning_date">{{ promotion.begnning_date }}</td>
						<td class="info" v-if="showColumn.ending_date">{{ promotion.ending_date }}</td>


						<!------------------------------------------------------------------------------------>
						<td  class="text-center" v-if="promotion.status">
							<button data-toggle="tooltip" title="Despublicar esta promoção" type="submit" @click = "promotionStatus(promotion.id)" class='btn btn-xs btn-flat' :class="{ 'btn-success': promotion.status, 'btn-warning': !promotion.status }"><i class="fa fa-check"></i></button>
						</td>

						<td  class="text-center" v-if="!promotion.status">
							<button data-toggle="tooltip" title="Publicar esta promoção" type="submit" @click = "promotionStatus(promotion.id)" class='btn btn-xs btn-flat' :class="{ 'btn-success': promotion.status, 'btn-warning': !promotion.status }"><i class="fa fa-times"></i></button>
						</td>
						<!------------------------------------------------------------------------------------>


						<td class="info" v-if="showColumn.service_beginning">{{ promotion.trader.name }}</td>

						<td align=left>  <a data-toggle="modal" data-target="#modal-edit-promotion" href="#"> <i class="fa fa-pencil text-primary" @click="getThisPromotion(promotion.id)" > </i></a></td>
						<td align=right><a data-toggle="modal" data-target="#modal-delete-promotion" href="#"><i class="fa fa-trash text-danger" @click="getThisPromotion(promotion.id)" ></i></a></td>
					</tr>
				</tbody>
			</table>
			<div class="col-md-12 pull-left">
				<Pagination :source.sync = "pagination" @navigate="navigate"></Pagination>
			</div>
		</div>

		<!--------------------------------------------------------------------------------------------------------->
		<div id="show-promotion" class="modal fade" role="dialog">
			<div class="modal-dialog">

				<!-- Modal content-->
				<div class="modal-content">
					<div class="modal-header">
						<button @click="clearField" type="button" class="close" data-dismiss="modal">&times;</button>
						<h4 class="modal-title">Detalhes do(a) {{ newPromotion.name }}</h4>
					</div>
					<div class="modal-body">
						<div class="row">
							<div class="col-md-12">
								<div class='table-responsive'>
									<table class='table table-striped table-hover'>
										<thead>
											<tr>
												<th class="text-center" colspan="2">INFORMAÇOES DE PROMOÇÃO</th>
											</tr>
										</thead>
										<tbody>
											<tr>
												<td><b>ID</b></td>
												<td><i>{{ newPromotion.id }}</i></td>
											</tr>
											<tr>
												<td><b>Nome</b></td>
												<td><i>{{ newPromotion.name }}</i></td>
											</tr>
											<tr>
												<td><b>Início</b></td>
												<td><span class="label label-info"><i>{{ newPromotion.begnning_date }}</i></span></td>

											</tr>
											<tr>
												<td><b>Término</b></td>
												<td><i>{{ newPromotion.ending_date }}</i></td>
											</tr>
											<tr>
												<td><b>Publicação</b></td>
												<td><span class='label' :class="{ 'label-success': newPromotion.status, 'label-warning': !newPromotion.status }"><i>{{newPromotion.status ? 'Publicado' : 'Aguardando'}}</i></span></td>
											</tr>

											<tr>
												<td><b>Descrição</b></td>
												<td><i>{{ newPromotion.description }}</i></td>
											</tr>
											<tr>
												<td><b>Data da criação</b></td>
												<td><i>{{ promotion.created_at | formatDate 'DD/MM/YYYY' }}</i></td>
											</tr>
											<tr>
												<td><b>Data de atualização</b></td>
												<td><i>{{ promotion.updated_at | formatDate 'DD/MM/YYYY' }}</i></td>
											</tr>

										</tbody>
									</table>
								</div>
							</div>
						</div>
					</div>
					<div class="modal-footer">
						<button @click="clearField" type="button" class="btn btn-success" data-dismiss="modal"><i class="fa fa-check"></i></button>
					</div>
				</div>

			</div>
		</div>



		<!--------------------------------------------------------------------------------------------------------->

		<div class="modal fade" id="modal-delete-promotion" tabindex="-1" role="dialog" aria-labelledby="" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
						<h4 class="modal-title" id="">Eliminar</h4>
					</div>
					<div class="modal-body">
						<h5>Eliminar - <span class="text-uppercase text-danger">{{newPromotion.name}}</span></h5>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-dismiss="modal"><i class="fa fa-times"></i> Cancelar</button>
						<button  @keyup.enter="deletePromotion(newPromotion.id)" @click="deletePromotion(newPromotion.id)" type="button" class="btn btn-danger"><i class="fa fa-trash-o"></i> Eliminar</button>
					</div>
				</div>
			</div>
		</div>


		<!--------------------------------------------------------------------------------------------------------->
		<!-- Modal -->
		<div id="modal-create-promotion" class="modal fade" role="dialog">
			<div class="modal-dialog">

				<!-- Modal content-->
				<div class="modal-content">
					<div class="modal-header">
						<button @click="clearField" type="button" class="close" data-dismiss="modal">&times;</button>
						<h4 class="modal-title">Registar</h4>
					</div>
					<div class="modal-body">
						<validator name="validationew">
							<form action="#" methods="POST">
								<div class="row">
									<div class="col-md-12">
										<div class="col-md-12">
											<div class="form-group has-feedback">
												<input type="text" class="form-control" name="name" placeholder="Nome" v-model="newPromotion.name" v-validate:name="['required']"/>
												<span class="fa fa-user form-control-feedback"></span>
											</div>
										</div>
									</div>
								</div>

								<div class="row">
									<div class="col-md-12">
										<div class="col-md-6">
											<div class="form-group has-feedback">
												<input type='date' name="begnning_date" class='form-control' placeholder='' v-model="newPromotion.begnning_date" v-validate:begnning_date = "['required']">
												<!-- <span class="fa fa-calendar-check-o form-control-feedback"></span> -->
												<p class="text-help">Data de início da promoção</p>
											</div>
										</div>
										<div class="col-md-6">
											<div class="form-group has-feedback">
												<input type='date' name="ending_date" class='form-control' placeholder='' v-model="newPromotion.ending_date"  v-validate:ending_date = "['required']">
												<!-- <span class="fa fa-calendar-times-o form-control-feedback"></span> -->
												<p class="text-help">Término da promoção</p>

											</div>
										</div>
									</div>
								</div>

								<hr><!------------------------------------------------------------>

								<div class="row">
									<div class="col-md-12">
										<div class="col-md-6">
											<div class="form-group has-feedback">
												<select name="trader_id" class="form-control" v-model="newPromotion.trader_id" v-validate:trader_id = "['required']">
													<option value="" selected>Comerciantes</option>
													<option v-for="trader in traders" value="{{trader.id}}">{{trader.name}}</option>
												</select>
											</div>
										</div>

										<div class="col-md-6">
											<div class="form-group has-feedback">
												<select name="product_id" class="form-control" v-model="newPromotion.product_id" v-validate:product_id = "['required']">
													<option value="" selected>Produtos</option>
													<option v-for="product in products" value="{{product.id}}">
														{{product.name}}
													</option>
												</select>
											</div>
										</div>
									</div>
								</div>

								<hr><!------------------------------------------------------------>

								<div class="row">
									<div class="col-md-12">
										<div class="col-md-12">
											<div class="form-group has-feedback">
												<textarea name="description" placeholder="Descrição..." class="form-control" rows="5" cols="40" id="description" v-model="newPromotion.description"></textarea>
											</div>
										</div>
									</div>
								</div>
							</form>
						</validator>
					</div>
					<div class="modal-footer">
						<button @click="clearField" type="button" class="btn btn-secondary" data-dismiss="modal"><i class="fa fa-times"></i>&nbsp; &nbsp;&nbsp; Cancelar</button>

						<button :disabled = "!$validationew.valid" @click="createPromotion" class="btn btn-primary pull-right" type="submit"><i class="fa fa-save"></i>&nbsp; &nbsp;&nbsp;Guardar</button>
					</div>
				</div>

			</div>
		</div>

		<!--------------------------------------------------------------------------------------------------------->


		<!-- Modal -->
		<div id="modal-edit-promotion" class="modal fade" role="dialog">
			<div class="modal-dialog">

				<!-- Modal content-->
				<div class="modal-content">
					<div class="modal-header">
						<button @click="clearField" type="button" class="close" data-dismiss="modal">&times;</button>
						<h4 class="modal-title">Editar</h4>
					</div>
					<div class="modal-body">
						<validator name="validation1">
							<form methods="patch">
								<div class="row">
									<div class="col-md-12">
										<div class="col-md-12">
											<div class="form-group has-feedback">
												<input type="text" class="form-control" name="name" placeholder="Nome" v-model="newPromotion.name" v-validate:name="['required']"/>
												<span class="fa fa-user form-control-feedback"></span>
											</div>
										</div>
									</div>
								</div>

								<div class="row">
									<div class="col-md-12">
										<div class="col-md-6">
											<div class="form-group has-feedback">
												<input type='date' class='form-control' placeholder='' v-model="newPromotion.begnning_date">
												<p class="text-help">Data de início da promoção</p>
											</div>
										</div>
										<div class="col-md-6">
											<div class="form-group has-feedback">
												<input type='date' class='form-control' placeholder='' v-model="newPromotion.ending_date">
												<p class="text-help">Término da promoção</p>
											</div>
										</div>
									</div>
								</div>

								<hr><!------------------------------------------------------------>

								<div class="row">
									<div class="col-md-12">
										<div class="col-md-6">
											<div class="form-group has-feedback">
												<select class="form-control" v-model="newPromotion.trader_id">
													<option value="" selected>Comerciantes</option>
													<option v-for="trader in traders" value="{{trader.id}}">{{trader.name}}</option>
												</select>
											</div>
										</div>

										<div class="col-md-6">
											<div class="form-group has-feedback">
												<select class="form-control" v-model="newPromotion.product_id">
													<option value="" selected>Produtos</option>
													<option v-for="product in products" value="{{product.id}}">
														{{product.name}}
													</option>
												</select>
											</div>
										</div>
									</div>
								</div>

								<hr><!------------------------------------------------------------>

								<div class="row">
									<div class="col-md-12">
										<div class="col-md-12">
											<div class="form-group has-feedback">
												<textarea name="description" placeholder="Descrição..." class="form-control" rows="5" cols="40" id="description" v-model="newPromotion.description"></textarea>
											</div>
										</div>
									</div>
								</div>
							</form>
						</validator>
					</div>
					<div class="modal-footer">
						<button @click="clearField" type="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-times"></i>&nbsp; &nbsp;&nbsp; Close</button>
						<button v-on:show="" @click="saveEditedPromotion(newPromotion.id)" type="button" class="btn btn-primary"><i class="fa fa-refresh fa-spin"></i>&nbsp; &nbsp;&nbsp; Atualizar</button>
					</div>
				</div>

			</div>
		</div>
	</div>
</div>
